<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta name="theme-color" content="#ffffff" />
    <title>Stories • Saraswathi</title>
    <link rel="icon" href="/icons/icon-192.png" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />
    <link rel="stylesheet" href="/styles.css" />
    <script defer src="/scripts/i18n.js?v=1758909457"></script>
    <link rel="preload" as="fetch" href="/i18n/en.json" crossorigin />
    <script defer src="/scripts/app.js?v=1758909457"></script>
  </head>
  <body>
    <div class="app">
      <header class="hero">
        <div style="display: flex; gap: 10px; align-items: center">
          <img
            src="/icons/icon-192.png"
            alt="Icon"
            width="36"
            height="36"
            style="border-radius: 8px"
          />
          <div>
            <h1 class="title" data-i18n="nav.stories">Stories</h1>
            <p class="subtitle">
              Stories • Festivals • Chants • Temples • Quiz
            </p>
          </div>
          <label for="langSelect" class="sr-only">Language</label
          ><select
            id="langSelect"
            class="lang-select"
            aria-label="Language"
          ></select>
        </div>
      </header>

      <main>
        <section class="card"><div id="stories"></div></section>
      </main>
    </div>
    <nav class="nav">
      <a href="/index.html"
        ><span class="nav-icon"
          ><svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
          >
            <path d="M12 3l6 3v3h-3v6h3v3H6v-3h3V9H6V6l6-3z" /></svg></span
        ><span class="nav-label" data-i18n="nav.home">Home</span></a
      >
      <a href="/stories.html"
        ><span class="nav-icon"
          ><svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
          >
            <path
              d="M3 5.5A2.5 2.5 0 0 1 5.5 3H21v16H5.5A2.5 2.5 0 0 0 3 21V5.5z"
            />
            <path d="M3 5.5A2.5 2.5 0 0 1 5.5 3H21" /></svg></span
        ><span class="nav-label" data-i18n="nav.stories">Stories</span></a
      >
      <a href="/chants.html"
        ><span class="nav-icon"
          ><svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
          >
            <path
              d="M12 21a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2zm6-6V9a6 6 0 1 0-12 0v6l-2 2v1h16v-1l-2-2z"
            /></svg></span
        ><span class="nav-label" data-i18n="nav.chants">Chants</span></a
      >
      <a href="/temples.html"
        ><span class="nav-icon"
          ><svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
          >
            <path d="M12 3l6 3v3h-3v6h3v3H6v-3h3V9H6V6l6-3z" /></svg></span
        ><span class="nav-label" data-i18n="nav.temples">Temples</span></a
      >
      <a href="/quiz.html"
        ><span class="nav-icon"
          ><svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
          >
            <path
              d="M12 2l1.5 4.5L18 8l-4.5 1.5L12 14l-1.5-4.5L6 8l4.5-1.5L12 2z"
            /></svg></span
        ><span class="nav-label" data-i18n="nav.quiz">Quiz</span></a
      >
    </nav>
  </body>
</html>
<script>
  const defaultEpisodes = [
    {
      t: "Birth of Saraswathi",
      d: "From Brahma’s breath emerged Saraswathi, gifting voice to the universe.",
    },
    {
      t: "Veena",
      d: "Her veena symbolizes harmony of knowledge and creativity.",
    },
    { t: "Swan", d: "The hamsa shows wisdom—choosing truth over illusion." },
    { t: "White Lotus", d: "Purity and the blossoming of wisdom." },
    { t: "Goddess of Speech", d: "Every word is considered her blessing." },
    {
      t: "Vasant Panchami",
      d: "Students place books seeking blessings for study.",
    },
    {
      t: "Navaratri",
      d: "Books & instruments are worshipped; taken on Vijayadashami.",
    },
    {
      t: "River Saraswati",
      d: "A hidden stream of wisdom in belief and lore.",
    },
    { t: "Sumbha", d: "Knowledge conquers ignorance and darkness." },
    { t: "Koothanur", d: "Students write wishes on slates for brilliance." },
    { t: "Basar", d: "Children begin ‘Akshara Abhyasam’." },
    { t: "Shringeri", d: "Sharada Peetham honors eternal wisdom." },
    { t: "Bija ‘Aim’", d: "Chant to sharpen intellect and focus." },
    { t: "Vandana", d: "‘Saraswati namastubhyam’ before study." },
    { t: "Blessing", d: "Saraswathi lights the path of learning." },
  ];
  function renderStories() {
    const list =
      (I18N.data.stories && I18N.data.stories.episodes) || defaultEpisodes;
    const el = document.getElementById("stories");
    el.innerHTML = list
      .map(
        (e) =>
          `<article class="story"><h4>${e.t}</h4><p>${e.d}</p><div style="display:flex;gap:8px;margin-top:8px"><button class="btn" data-i18n="nav.chants">Chants</button><button class="btn ghost">Share</button></div></article>`
      )
      .join("");
  }
  document.addEventListener("DOMContentLoaded", () => {
    if (window.I18N) {
      renderStories();
    }
  });
  document.addEventListener("click", (e) => {
    /* placeholder */
  });
</script>

<script>
  /* Stories playlist (mobile-first, no layout changes)
   - If i18n provides stories.episodes (array), uses that:
       [{ title, desc, audio }] or array of strings (title only)
     via i18next.t('stories.episodes', { returnObjects: true })
     or window.I18N?.data?.stories?.episodes.
   - Else falls back to a static 12-item list.
   - Renders into #stories only; keeps page dimensions intact.
*/
  (function () {
    const FALLBACK = [
      {
        id: 1,
        title: "Born From the First Breath",
        desc: "Brahma’s breath gives form to Saraswati—speech becoming the world’s first word.",
        audio: "assets/audio/ep01-born-from-the-first-breath.mp3",
      },
      {
        id: 2,
        title: "I Am the Queen (Vāk Sūkta)",
        desc: "Speech introduces herself; Saraswati as the voice behind all voices.",
        audio: "assets/audio/ep02-i-am-the-queen.mp3",
      },
      {
        id: 3,
        title: "River of Thunder",
        desc: "Saraswati as mighty river-goddess who clears obstacles and brings victory.",
        audio: "assets/audio/ep03-river-of-thunder.mp3",
      },
      {
        id: 4,
        title: "Invisible Third at the Confluence",
        desc: "Where Ganga and Yamuna meet, tradition says Saraswati flows invisibly.",
        audio: "assets/audio/ep04-invisible-third.mp3",
      },
      {
        id: 5,
        title: "Pushkar and the Curse",
        desc: "Brahma’s sacrifice, Gayatri’s arrival, and Savitri’s fateful curse.",
        audio: "assets/audio/ep05-pushkar-and-the-curse.mp3",
      },
      {
        id: 6,
        title: "Kalidasa’s Blessing",
        desc: "The mocked youth touched by Saraswati becomes the poet Kalidasa.",
        audio: "assets/audio/ep06-kalidasa-blessing.mp3",
      },
      {
        id: 7,
        title: "Throne of Wisdom",
        desc: "Śāradā Peeth and the Sarvajña Pīṭha—trial of knowledge and purity.",
        audio: "assets/audio/ep07-throne-of-wisdom.mp3",
      },
      {
        id: 8,
        title: "Veena Across the Sea",
        desc: "Saraswati journeys as Benzaiten—eloquence and music in Japan.",
        audio: "assets/audio/ep08-veena-across-the-sea.mp3",
      },
      {
        id: 9,
        title: "First Letters on Rice",
        desc: "Vidyarambham/Aksharabhyāsa—the alphabet as an offering to the goddess.",
        audio: "assets/audio/ep09-first-letters-on-rice.mp3",
      },
      {
        id: 10,
        title: "Following a Vanished River",
        desc: "Balarama’s pilgrimage along Saraswati’s course—river and word as one.",
        audio: "assets/audio/ep10-vanished-river.mp3",
      },
      {
        id: 11,
        title: "Co-Wives of the Cosmos",
        desc: "Fluid Puranic tellings of Saraswati with Brahma, Vishnu, and Ganga.",
        audio: "assets/audio/ep11-co-wives-of-the-cosmos.mp3",
      },
      {
        id: 12,
        title: "The Swan that Chooses Clarity",
        desc: "Hamsa as viveka—the power to discern the pure note in the noise.",
        audio: "assets/audio/ep12-the-swan-of-clarity.mp3",
      },
    ];

    function getFromI18next() {
      try {
        if (window.i18next && typeof window.i18next.t === "function") {
          // Prefer an array from translations
          const arr = window.i18next.t("stories.episodes", {
            returnObjects: true,
          });
          if (Array.isArray(arr) && arr.length) return normalize(arr);
          // Fallback: numbered keys stories.episodes.0.title etc.
          const tmp = [];
          for (let i = 0; i < 50; i++) {
            const title = window.i18next.t(`stories.episodes.${i}.title`);
            if (!title || title === `stories.episodes.${i}.title`) break;
            const desc = window.i18next.t(`stories.episodes.${i}.desc`, {
              defaultValue: "",
            });
            const audio = window.i18next.t(`stories.episodes.${i}.audio`, {
              defaultValue: "",
            });
            tmp.push({ title, desc, audio });
          }
          if (tmp.length) return normalize(tmp);
        }
      } catch (e) {}
      return null;
    }

    function getFromGlobal() {
      try {
        const data =
          (window.I18N &&
            window.I18N.data &&
            window.I18N.data.stories &&
            window.I18N.data.stories.episodes) ||
          null;
        if (Array.isArray(data) && data.length) return normalize(data);
      } catch (e) {}
      return null;
    }

    function normalize(arr) {
      // Ensure shape: { id, title, desc, audio }
      return arr.map((it, idx) => {
        if (typeof it === "string") {
          return {
            id: idx + 1,
            title: it,
            desc: "",
            audio: guessAudio(idx + 1),
          };
        } else {
          return {
            id: it.id || idx + 1,
            title: it.title || it.t || `Episode ${idx + 1}`,
            desc: it.desc || it.description || "",
            audio: it.audio || it.src || guessAudio(idx + 1),
          };
        }
      });
    }

    function guessAudio(n) {
      const num = String(n).padStart(2, "0");
      return `assets/audio/ep${num}.mp3`;
    }

    function playlistData() {
      return getFromI18next() || getFromGlobal() || FALLBACK;
    }

    function render() {
      const list = playlistData();
      const el = document.getElementById("stories");
      if (!el || !list || !list.length) return;
      const current = list[0];
      const html = `
      <div class="player" style="display:flex;flex-direction:column;gap:10px">
        <div style="display:flex;align-items:center;gap:10px">
          <img src="/icons/icon-192.png" alt="" width="36" height="36" style="border-radius:8px">
          <div>
            <h3 id="currentTitle" class="title" style="margin:0">${
              current.title
            }</h3>
            <p id="currentDesc" class="subtitle" style="margin:2px 0 0">${
              current.desc || ""
            }</p>
          </div>
        </div>
        <audio id="audio" controls preload="metadata" style="width:100%" aria-label="Story audio player">
          <source id="audioSrc" src="${current.audio}" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
      </div>
      <ol class="playlist" style="list-style:none;padding:0;margin:10px 0;display:flex;flex-direction:column;gap:8px">
        ${list
          .map(
            (item) => `
          <li>
            <button class="btn ghost" data-id="${
              item.id
            }" style="display:flex;align-items:flex-start;gap:10px;width:100%">
              <span style="min-width:28px;text-align:right">${String(
                item.id
              ).padStart(2, "0")}</span>
              <span>
                <strong>${item.title}</strong><br>
                <small class="muted">${item.desc || ""}</small>
              </span>
            </button>
          </li>
        `
          )
          .join("")}
      </ol>
    `;
      el.innerHTML = html;

      const audio = document.getElementById("audio");
      const audioSrc = document.getElementById("audioSrc");
      const titleEl = document.getElementById("currentTitle");
      const descEl = document.getElementById("currentDesc");

      el.addEventListener(
        "click",
        (e) => {
          const btn = e.target.closest("button[data-id]");
          if (!btn) return;
          const id = Number(btn.getAttribute("data-id"));
          const item = list.find((x) => x.id === id);
          if (!item) return;
          titleEl.textContent = item.title;
          descEl.textContent = item.desc || "";
          audioSrc.src = item.audio;
          audio.load();
          audio.play().catch(() => {});
        },
        { passive: true }
      );
    }

    // Render when ready; also listen for i18next language changes if present
    document.addEventListener("DOMContentLoaded", render);
    if (window.i18next && typeof window.i18next.on === "function") {
      window.i18next.on("languageChanged", render);
    }
  })();
</script>
