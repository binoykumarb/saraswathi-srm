<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Interactive Pooja (ƒÄrati)</title>
    <script src="https://cdn.tailwindcss.com"></script>
  
    <style>
      html,body{margin:0;height:100%;background:transparent}
      #root{min-height:100%;display:flex;align-items:center;justify-content:center; padding:8px}
      /* Shrink any big wrappers from Tailwind min-h-full defaults */
      .min-h-screen,.min-h-full{min-height:unset!important}
    </style>

  <style>html,body{height:100%;background:transparent;margin:0}</style>
<style>
/* === App-specific overrides inserted by parent app === */
.grid.md\:grid-cols-3{ grid-template-columns: 1fr auto 1fr !important; align-items:start }
.grid.md\:grid-cols-3 > div:nth-child(1){ grid-column: 2 !important; } /* Bell column to center */
.grid.md\:grid-cols-3 > div:nth-child(2){ grid-column: 1 !important; } /* Thali (with gif) to left */
.grid.md\:grid-cols-3 > div:nth-child(3){ grid-column: 3 !important; } /* Controls to right */

/* Shrink bell */
.grid.md\:grid-cols-3 > div:nth-child(1) button svg{ width:56px !important; height:56px !important; }
.grid.md\:grid-cols-3 > div:nth-child(1) .mt-2{ font-size:12px !important; }

/* Move Saraswati gif to top-left of thali area */


/* Ensure the thali container has enough top padding to not crop the gif */


/* Tighten the control buttons spacing so bell sits visually between them and thali */
.grid.md\:grid-cols-3 > div:nth-child(3){ gap:10px; }
</style>
</head>
  <body class="bg-transparent overflow-hidden">
    <div id="root"></div>

    <script type="module">
      import React, { useEffect, useRef, useState } from "https://esm.sh/react@18.3.1";
      import { createRoot } from "https://esm.sh/react-dom@18.3.1/client";
      import { motion, AnimatePresence, useMotionValue, useTransform } from "https://esm.sh/framer-motion@11.2.10";

      function PoojaAartiInteractive() {
        const [lit, setLit] = useState(false);
        const [autoAarti, setAutoAarti] = useState(false);
        const [offers, setOffers] = useState(0);
        const [smokePuffs, setSmokePuffs] = useState([]);
        const [message, setMessage] = useState("Click the diya to light it ‚ú®");

        const rotation = useMotionValue(0);
        const thaliRef = useRef(null);
        const dragging = useRef(false);
        const lastAngle = useRef(0);

        const glow = useTransform(rotation, [0, 360], [0.15, 0.25]);

        const audioCtxRef = useRef(null);
        function ringBell() {
          try {
            if (!audioCtxRef.current) {
              const Ctx = window.AudioContext || window.webkitAudioContext;
              audioCtxRef.current = new Ctx();
            }
            const ctx = audioCtxRef.current;
            const now = ctx.currentTime;
            const o1 = ctx.createOscillator();
            const o2 = ctx.createOscillator();
            const gain = ctx.createGain();
            o1.type = "sine"; o2.type = "sine";
            o1.frequency.setValueAtTime(784, now);
            o2.frequency.setValueAtTime(1568, now);
            gain.gain.setValueAtTime(0.0001, now);
            gain.gain.exponentialRampToValueAtTime(0.4, now + 0.01);
            gain.gain.exponentialRampToValueAtTime(0.0001, now + 1.4);
            o1.connect(gain); o2.connect(gain); gain.connect(ctx.destination);
            o1.start(); o2.start();
            o1.stop(now + 1.5); o2.stop(now + 1.5);
            const click = ctx.createOscillator();
            const cg = ctx.createGain();
            click.type = "triangle";
            click.frequency.setValueAtTime(2200, now);
            cg.gain.setValueAtTime(0.001, now);
            cg.gain.exponentialRampToValueAtTime(0.2, now + 0.005);
            cg.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
            click.connect(cg).connect(ctx.destination);
            click.start(); click.stop(now + 0.12);
            setMessage("üîî GhantƒÅ rung");
          } catch (e) {
            setMessage("(Sound unavailable ‚Äì your browser blocked audio)");
          }
        }

        useEffect(() => {
          const onKey = (e) => {
            if (e.key.toLowerCase() === "b") ringBell();
            if (e.key.toLowerCase() === "l") setLit(v => !v);
            if (e.key.toLowerCase() === "a") setAutoAarti(v => !v);
          };
          window.addEventListener("keydown", onKey);
          return () => window.removeEventListener("keydown", onKey);
        }, []);

        useEffect(() => {
          let raf = 0;
          if (autoAarti) {
            const loop = () => {
              rotation.set((rotation.get() + 0.9) % 360);
              raf = requestAnimationFrame(loop);
            };
            raf = requestAnimationFrame(loop);
            setMessage("Auto ƒÅrati on (press ‚ÄòA‚Äô to stop)");
          }
          return () => cancelAnimationFrame(raf);
        }, [autoAarti]);

        function angleFromEvent(ev) {
          const el = thaliRef.current;
          if (!el) return 0;
          const rect = el.getBoundingClientRect();
          const cx = rect.left + rect.width/2;
          const cy = rect.top + rect.height/2;
          const dx = ev.clientX - cx;
          const dy = ev.clientY - cy;
          return Math.atan2(dy, dx) * 180/Math.PI;
        }

        const onPointerDown = (e) => {
          dragging.current = true;
          lastAngle.current = angleFromEvent(e);
          e.target.setPointerCapture(e.pointerId);
        };
        const onPointerUp = () => { dragging.current = false; };
        const onPointerMove = (e) => {
          if (!dragging.current) return;
          const a = angleFromEvent(e);
          let delta = a - lastAngle.current;
          delta = ((delta + 540) % 360) - 180;
          rotation.set((rotation.get() + delta + 360) % 360);
          lastAngle.current = a;
        };

        useEffect(() => {
          if (!lit) return;
          const id = setInterval(() => {
            setSmokePuffs(prev => [...prev, { id: Math.random(), x: 50 + Math.random() * 10 - 5 }].slice(-12));
          }, 900);
          return () => clearInterval(id);
        }, [lit]);

        const removeSmoke = (id) => setSmokePuffs(puffs => puffs.filter(p => p.id !== id));
        const dropPetal = () => { setOffers(n => Math.min(n + 1, 12)); setMessage("üå∏ Flower offered"); };

        return (
          React.createElement("div", {className: "min-h-screen bg-gradient-to-b from-orange-50 to-amber-100 text-stone-800 flex flex-col items-center justify-center p-6 select-none"},
            React.createElement("div", {className: "max-w-3xl w-full"},
              React.createElement("h1", {className: "text-3xl md:text-4xl font-semibold text-center mb-2"}, "Interactive Pooja (ƒÄrati)"),
              React.createElement("p", {className: "text-center text-sm md:text-base opacity-80 mb-4"},
                "Ring the ", React.createElement("strong", null, "bell"), ", light the ", React.createElement("strong", null, "diya"), ", and rotate the ", React.createElement("strong", null, "thƒÅli"), " clockwise. ",
                "Keys: ", React.createElement("kbd", {className: "px-1"}, "A"), " auto ƒÅrati, ",
                React.createElement("kbd", {className: "px-1"}, "B"), " bell, ",
                React.createElement("kbd", {className: "px-1"}, "L"), " diya."
              ),
              React.createElement("div", {className: "grid md:grid-cols-3 gap-4 items-start"},
                React.createElement("div", {className: "flex flex-col items-center"},
  React.createElement("img", {src:"./assets/Saraswathe%20devi.gif", alt:"Goddess Saraswati", className:"w-16 md:w-20 h-auto object-contain rounded-lg drop-shadow-[0_6px_24px_rgba(0,0,0,0.35)] mb-2"}),
  
                  React.createElement("button", {onClick: ringBell, className: "active:scale-95 transition"},
                    React.createElement(BellSVG, null)
                  ),
                  React.createElement("span", {className: "mt-2 text-sm"}, "Tap to ring")
                ),
                React.createElement("div", {className: "col-span-2 md:col-span-1 md:order-none order-last"},
                  React.createElement("div", {className: "relative"},
                    React.createElement(motion.svg, {
                      ref: thaliRef,
                      viewBox: "0 0 300 300",
                      className: "w-full drop-shadow-2xl rounded-2xl bg-amber-50",
                      style: { rotate: rotation },
                      onPointerDown, onPointerUp, onPointerMove
                    },
                      React.createElement("defs", null,
                        React.createElement("radialGradient", {id: "plate", cx:"50%", cy:"50%", r:"50%"},
                          React.createElement("stop", {offset:"0%", stopColor:"#f0d9a1"}),
                          React.createElement("stop", {offset:"70%", stopColor:"#d8b879"}),
                          React.createElement("stop", {offset:"100%", stopColor:"#b39254"}),
                        ),
                        React.createElement("filter", {id:"softGlow"},
                          React.createElement("feGaussianBlur", {stdDeviation:"8", result:"blur"}),
                          React.createElement("feMerge", null,
                            React.createElement("feMergeNode", {in:"blur"}),
                            React.createElement("feMergeNode", {in:"SourceGraphic"}),
                          )
                        )
                      ),
                      React.createElement("circle", {cx:"150", cy:"150", r:"140", fill:"url(#plate)", stroke:"#b0823a", strokeWidth:"6"}),
                      React.createElement("g", {transform:"translate(150,160)"},
                        React.createElement(Diya, {lit, glow})
                      ),
                      React.createElement("g", {transform:"translate(220,120)"},
                        React.createElement(Incense, {lit, smokePuffs, onVanish: removeSmoke})
                      ),
                      Array.from({length:8}).map((_, i) => {
                        const angle = (i / 8) * Math.PI * 2;
                        const x = 150 + Math.cos(angle) * 95;
                        const y = 150 + Math.sin(angle) * 95;
                        return React.createElement(Flower, {key: i, x, y});
                      }),
                      React.createElement("g", {onClick: dropPetal, style:{cursor: "pointer"}},
                        React.createElement("text", {x:"150", y:"285", textAnchor:"middle", fontFamily:"ui-sans-serif", fontSize:"12", fill:"#6b4f1d"}, "Click here to offer a flower üå∏")
                      ),
                      Array.from({length: offers}).map((_, i) => React.createElement(Petal, {key: i, x: 120 + i*3, y: 200 + i*2}))
                    ),
                    
                    React.createElement("div", {className:"absolute -top-3 left-1/2 -translate-x-1/2 text-xs bg-white/80 backdrop-blur px-3 py-1 rounded-full shadow"}, "Drag the plate ‚Üª clockwise for ƒÅrati")
                  )
                ),
                React.createElement("div", {className: "flex flex-col items-center gap-2"},
                  React.createElement("button", {onClick: () => setLit(v => !v), className: "px-4 py-2 rounded-2xl shadow bg-white hover:shadow-md"}, lit ? "Extinguish diya" : "Light diya"),
                  React.createElement("button", {onClick: () => setAutoAarti(v => !v), className: "px-4 py-2 rounded-2xl shadow bg-white hover:shadow-md"}, autoAarti ? "Stop auto ƒÅrati" : "Start auto ƒÅrati"),
                  React.createElement("button", {onClick: () => { setOffers(0); setSmokePuffs([]); }, className: "px-4 py-2 rounded-2xl shadow bg-white hover:shadow-md"}, "Reset offerings")
                )
              ),
              React.createElement("p", {className: "text-center mt-4 text-sm italic opacity-80"}, message),
              React.createElement(HelpPanel, null)
            ),
            React.createElement("style", null, `
              .flame { transform-origin: 50% 80%; animation: flicker 0.12s infinite alternate ease-in-out; }
              @keyframes flicker { from { transform: skewX(-1deg) scaleY(0.98); opacity: 0.9; } to { transform: skewX(1deg) scaleY(1.02); opacity: 1; } }
              .smoke { opacity: 0.35; }
            `)
          )
        );
      }

      function HelpPanel(){
        return React.createElement("div", {className:"mt-6 grid md:grid-cols-3 gap-4 text-sm"},
          React.createElement("div", {className:"bg-white/80 backdrop-blur rounded-2xl p-4 shadow"},
            React.createElement("h3", {className:"font-semibold mb-2"}, "What‚Äôs happening?"),
            React.createElement("ul", {className:"list-disc list-inside space-y-1"},
              React.createElement("li", null, "ƒÄrati is traditionally performed in a ", React.createElement("em", null, "clockwise"), " circle."),
              React.createElement("li", null, "Bell (", React.createElement("em", null, "ghantƒÅ"), ") is rung during offerings."),
              React.createElement("li", null, "Diya (oil lamp) symbolizes light & knowledge.")
            )
          ),
          React.createElement("div", {className:"bg-white/80 backdrop-blur rounded-2xl p-4 shadow"},
            React.createElement("h3", {className:"font-semibold mb-2"}, "Try these:"),
            React.createElement("ul", {className:"list-disc list-inside space-y-1"},
              React.createElement("li", null, "Hold & drag the plate ‚Üª to rotate."),
              React.createElement("li", null, "Press ", React.createElement("kbd", null, "A"), " for auto ƒÅrati, ", React.createElement("kbd", null, "B"), " to ring, ", React.createElement("kbd", null, "L"), " to light."),
              React.createElement("li", null, "Tap the caption to offer flowers ‚Äì petals will appear near the diya.")
            )
          ),
          React.createElement("div", {className:"bg-white/80 backdrop-blur rounded-2xl p-4 shadow"},
            React.createElement("h3", {className:"font-semibold mb-2"}, "Notes"),
            React.createElement("ul", {className:"list-disc list-inside space-y-1"},
              React.createElement("li", null, "Deity image shown respectfully (you can replace the GIF/PNG to localize the artwork)."),
              React.createElement("li", null, "All graphics are inline SVG; audio uses the browser‚Äôs WebAudio.")
            )
          )
        );
      }

      function Diya({lit, glow}){
        return React.createElement("g", null,
          React.createElement("path", {d:"M-40 20 Q0 48 40 20 Q25 5 -25 5 Z", fill:"#9c4f1c", stroke:"#6e3712", strokeWidth:"2"}),
          React.createElement("path", {d:"M-35 17 Q0 38 35 17", fill:"#e3a26b", opacity:"0.5"}),
          React.createElement("rect", {x:"-2.5", y:"-12", width:"5", height:"17", rx:"2", fill:"#3a2a1a"}),
          React.createElement(AnimatePresence, null, lit && React.createElement(motion.g, {initial:{opacity:0, y:4}, animate:{opacity:1, y:0}, exit:{opacity:0, y:-6}},
            React.createElement("g", {className:"flame"},
              React.createElement("radialGradient", {id:"flameGrad", cx:"50%", cy:"50%", r:"50%"},
                React.createElement("stop", {offset:"0%", stopColor:"#fff9c4"}),
                React.createElement("stop", {offset:"55%", stopColor:"#ffcc80"}),
                React.createElement("stop", {offset:"100%", stopColor:"#ff8f00"})
              ),
              React.createElement("path", {d:"M0 -45 C12 -28 10 -10 0 0 C-10 -10 -12 -28 0 -45 Z", fill:"url(#flameGrad)", filter:"url(#softGlow)"}),
              React.createElement("circle", {cx:"0", cy:"-20", r:"16", fill:"#ffd54f", opacity:"0.65"})
            ),
            React.createElement(motion.circle, {cx:"0", cy:"0", r:"70", fill:"#ffecb3", style:{opacity: glow}})
          ))
        );
      }

      function Incense({lit, smokePuffs, onVanish}){
        return React.createElement("g", null,
          React.createElement("rect", {x:"-2", y:"0", width:"4", height:"40", rx:"2", fill:"#6d4c41", transform:"rotate(-20)"}),
          React.createElement("rect", {x:"-1.5", y:"-10", width:"3", height:"10", rx:"1.5", fill:"#a1887f"}),
          lit && React.createElement("circle", {cx:"0", cy:"-10", r:"3", fill:"#ee6c4d"}),
          lit && smokePuffs.map(p => React.createElement(Smoke, {key:p.id, id:p.id, x:p.x, onVanish}))
        );
      }

      function Smoke({id, x, onVanish}){
        return React.createElement(motion.g, {
          initial:{opacity:0, y:0},
          animate:{opacity:0.4, y:-60, x, scale:[1,1.1,1]},
          transition:{duration:2.6, ease:"easeOut"},
          onAnimationComplete:() => onVanish(id),
          className:"smoke"
        }, React.createElement("path", {d:"M0 0 C-4 -10 4 -20 0 -30", stroke:"#5d4037", strokeWidth:"3", fill:"none", strokeLinecap:"round"}));
      }

      function Flower({x, y}){
        const petals = Array.from({length:6});
        return React.createElement("g", {transform:`translate(${x},${y})`},
          petals.map((_, i) => {
            const a = (i / petals.length) * Math.PI * 2;
            const px = Math.cos(a) * 9;
            const py = Math.sin(a) * 9;
            return React.createElement("ellipse", {key:i, cx:px, cy:py, rx:"7", ry:"11", fill:"#e91e63", opacity:"0.85"});
          }),
          React.createElement("circle", {cx:"0", cy:"0", r:"4.5", fill:"#ffeb3b"})
        );
      }

      function Petal({x, y}){
        return React.createElement(motion.ellipse, {
          cx:x, cy:y, rx:"7", ry:"11", fill:"#f06292", opacity:"0.9",
          initial:{opacity:0, y:-10}, animate:{opacity:1, y:0}, transition:{duration:0.6}
        });
      }

      function BellSVG(){
        return React.createElement("svg", {viewBox:"0 0 120 120", className:"w-28 drop-shadow-xl"},
          React.createElement("defs", null,
            React.createElement("linearGradient", {id:"bell", x1:"0", x2:"0", y1:"0", y2:"1"},
              React.createElement("stop", {offset:"0%", stopColor:"#ffd87a"}),
              React.createElement("stop", {offset:"100%", stopColor:"#c8942c"})
            )
          ),
          React.createElement("g", null,
            React.createElement(motion.path, {
              d:"M60 16 c-8 0-14 6-14 14 v6 c-10 8-18 28-18 44 h64 c0-16-8-36-18-44 v-6 c0-8-6-14-14-14z",
              fill:"url(#bell)", stroke:"#9a6a16", strokeWidth:"3",
              animate:{ rotate:[0,-6,6,0] }, transition:{ repeat: Infinity, duration: 2.4, ease:"easeInOut" },
              style:{ transformOrigin: "60px 80px" }
            }),
            React.createElement("circle", {cx:"60", cy:"88", r:"6", fill:"#9a6a16"}),
            React.createElement("rect", {x:"54", y:"10", width:"12", height:"8", rx:"3", fill:"#9a6a16"})
          ),
          React.createElement("text", {x:"60", y:"115", textAnchor:"middle", fontFamily:"ui-sans-serif", fontSize:"12", fill:"#6b4f1d"}, "Ring")
        );
      }

      const root = createRoot(document.getElementById("root"));
      root.render(React.createElement(PoojaAartiInteractive));
    </script>
  </body>
</html>
